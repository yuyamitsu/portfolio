<!DOCTYPE html>
<html lang="ja">

<head>
    <link rel="stylesheet" href="styles/reset.css">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles/common.css">
    <link rel="stylesheet" href="styles/lightsOut.css">
    <title>Lights Out Game</title>
</head>

<body>
    <header>
        <h1 class="popFont">Lights Out</h1>
    </header>
    <div id="controls">
        <label for="gridSize">サイズ選択:</label>
        <select id="gridSize">
        </select>
        <button id="startBtn">スタート</button>
    </div>

    <div id="board"></div>
    <p id="message"></p>



    <footer>
        <p>&copy; 2025 Yuya Mitsugi</p>
    </footer>

    <script>
        let size = 3;
        let board = [];

        const boardElem = document.getElementById('board');
        const gridSizeSelect = document.getElementById('gridSize');
        const messageElem = document.getElementById('message');

        for (let i=1;i<=10;i++) {
            const option = document.createElement('option');
            option.value = i;
            option.textContent = `${i}×${i}`;
            gridSizeSelect.append(option);
        }

        document.getElementById('startBtn').addEventListener('click', () => {
            size = Number(gridSizeSelect.value);
            createBoard(size);
        });

        function createBoard(size) {
            board = [];
            boardElem.innerHTML = '';
            boardElem.style.gridTemplateColumns = `repeat(${size}, 60px)`;

            for (let i = 0; i < size * size; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                if (Math.random() < 0.5) cell.classList.add('on');
                cell.dataset.index = i;
                boardElem.appendChild(cell);
                board.push(cell);
            }

            board.forEach((cell, index) => {
                cell.addEventListener('click', () => {
                    toggle(index);
                    checkClear();
                });
            });

            messageElem.textContent = '';
        }

        function toggle(index) {
            const row = Math.floor(index / size);
            const col = index % size;
            const toggleTargets = [
                [row, col],
                [row - 1, col],
                [row + 1, col],
                [row, col - 1],
                [row, col + 1]
            ];

            toggleTargets.forEach(([r, c]) => {
                if (r >= 0 && r < size && c >= 0 && c < size) {
                    const i = r * size + c;
                    board[i].classList.toggle('on');
                }
            });
        }

        function checkClear() {
            const isCleared = board.every(cell => !cell.classList.contains('on'));
            if (isCleared) {
                messageElem.textContent = 'クリア！✨';
            }
        }

        // 最初に3×3で起動
        // createBoard(size);
    </script>
</body>

</html>